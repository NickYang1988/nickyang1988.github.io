<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /> 
    <title>[网络开发]RakNet文档翻译(2)——Connecting - C&#43;&#43;爱好者博客</title>
    <meta name="keywords" content="backend,game develop,programming,python,linux,vps,大数据,后端,游戏开发,服务器,机器学习,深度学习">
    
    <meta property="og:title" content="[网络开发]RakNet文档翻译(2)——Connecting">
    <meta property="og:site_name" content="C&#43;&#43;爱好者博客">
    <meta property="og:image" content="/img/author.jpg"> 
    <meta name="title" content="[网络开发]RakNet文档翻译(2)——Connecting - C&#43;&#43;爱好者博客" />
    <meta name="description" content="关注游戏开发，互联网动态，服务器，后端，大数据等相关内容"> 
    <link rel="shortcut icon" href="https://cppfans.org/img/favicon.ico" />
    <link rel="apple-touch-icon" href="https://cppfans.org/img/apple-touch-icon.png" />
    <link rel="apple-touch-icon-precomposed" href="https://cppfans.org/img/apple-touch-icon.png" />
    <link href="https://cppfans.org/js/vendor/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />
    <link href="https://cppfans.org/js/vendor/fancybox/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />
    <link href="https://cppfans.org/css/main.css" rel="stylesheet" type="text/css" />
    <link href="https://cppfans.org/css/syntax.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
     fancybox: true, 
    motion: true
  };
</script>
</head>
<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">
<div class="container one-collumn sidebar-position-left page-home  ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-meta  custom-logo ">

  <div class="custom-logo-site-title">
    <a href="https://cppfans.org"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">C&#43;&#43;爱好者博客</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Be a simple man.</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
    <ul id="menu" class="menu">
      
      
        <li class="menu-item ">
          <a href="https://cppfans.org/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="https://cppfans.org/post/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="https://cppfans.org/about/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />关于
          </a>
        </li>
      
        <li class="menu-item ">
          <a href="https://cppfans.org/links/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-link"></i> <br />友链
          </a>
        </li>
      
      <li class="menu-item menu-item-search">
        <a href="javascript:;" class="popup-trigger"> <i class="menu-item-icon fa fa-search fa-fw"></i> <br /> 搜索</a>
      </li>
    </ul>
    <div class="site-search">
      <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>

    </div>
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
<section id="posts" class="posts-expand">
  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">
        <a class="post-title-link" href="https://cppfans.org/1299.html" itemprop="url">
        [网络开发]RakNet文档翻译(2)——Connecting
        </a>
      </h1>
      <div class="post-meta">
      <span class="post-time">
<span class="post-meta-item-icon">
    <i class="fa fa-calendar-o"></i>
</span>
<span class="post-meta-item-text">时间：</span>
<time itemprop="dateCreated" datetime="2016-03-22T13:04:35+08:00" content="2012-04-15">
    2012-04-15
</time>
</span> 
      

  <span class="post-category" >
  &nbsp; | &nbsp;
  <span class="post-meta-item-icon">
    <i class="fa fa-folder-o"></i>
  </span>
  <span class="post-meta-item-text">分类：</span>
  
    <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
      <a href="https://cppfans.org/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E7%AB%A0" itemprop="url" rel="index">
        <span itemprop="name">技术文章</span>
      </a>
      &nbsp; 
    </span>
  
    <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
      <a href="https://cppfans.org/categories/%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91" itemprop="url" rel="index">
        <span itemprop="name">程序开发</span>
      </a>
      &nbsp; 
    </span>
  
</span>


       <span>
&nbsp; | &nbsp;
<span class="post-meta-item-icon">
    <i class="fa fa-eye"></i>
</span>
<span class="post-meta-item-text">阅读：</span>
<span class="leancloud-visitors-count">2854 字 ~6分钟</span>
</span>
      </div>
    </header>
    <div class="post-body" itemprop="articleBody">
    

<h1 id="connecting-to-other-systems">Connecting to other systems</h1>

<p>&nbsp;</p>

<h2 id="找到连接的对象">找到连接的对象</h2>

<p>下面是5种连接到其他系统的方法：</p>

<p>1.直接通过IP地址(前提是你已经知道该IP)</p>

<p>2.LAN广播</p>

<p>3.使用云服务器或者云客户端插件</p>

<p>4.使用大厅服务器或者房间插件(译者注：类型与游戏大厅和游戏房间的模式，想想QQ棋牌游戏)</p>

<p>5.使用DirectoryServer.php</p>

<h3 id="方法1-直接使用ip地址">方法1：直接使用IP地址</h3>

<p>从编码的角度来说，最简单最容易的方法是硬编码的IP地址或者域名或者给出一个GUI要求用户输入他们相连接到其他系统的IP地址，大部分例子使用此方法。回顾网络游戏刚刚出现的时候使用此方法，也是当时唯一可用的方法。</p>

<blockquote>
<p>优点：</p>

<ul>
<li>对程序员或者美工来说很简单，GUI界面可以很简单</li>
<li>如果IP地址或者域名是固定的，例如你运行了一个专用服务器，这是一个正确的解决方案。</li>
</ul>

<p>缺点：</p>

<ul>
<li>不够灵活</li>
<li>用户只能与他们认识的人玩游戏</li>
</ul>
</blockquote>

<p>注意：在同一台电脑或者相同的应用程序，可以使用127.0.0.1或者 localhost连接到另外一个RakPeer实例。</p>

<h3 id="方法2-局域网广播">方法2：局域网广播</h3>

<p>RakNet支持广播一个数据包找到本地局域网内其他系统的功能，使用可选的数据包发送和检测应用程序，LANServerDiscovery例子展示了这个技术。</p>

<p>在RakPerrInterface.h中，Ping函数可以试下如下个功能</p>

<pre class="lang:c++ decode:true">rakPeer-&gt;Ping( "255.255.255.255", REMOTE_GAME_PORT,
onlyReplyOnAcceptingConnections );</pre>

<p>REMOTE_GAME_PORT可以是你关心的应用程序运行在其他系统上的任何端口。onlyReplyOnAcceptingConnections 是一个标志其他系统是否应该答复的布尔值，即使你没有连接到其他系统上的可用连接。</p>

<p>开放系统将会用ID_UNCONNECTED_PONG，看看下面的例子：</p>

<pre class="lang:c++ decode:true">if (p-&gt;data[0]==ID_UNCONNECTED_PONG)
{
    RakNet::TimeMS time;
    RakNet::BitStream bsIn(packet-&gt;data,packet-&gt;length,false);
    bsIn.IgnoreBytes(1);
    bsIn.Read(time);
    printf("Got pong from %s with time %i\n", p-&gt;systemAddress.ToString(),
RakNet::GetTime() - time);
}</pre>

<p>为了发送用户自定义数据，调用 RakPeer::SEtOfflinePingResponse( customUserData, lengthInBytes ); RakNet将会拷贝传给他的数据，同时返回值追加到ID_UNCONNECTED_PONG。(译者注：猜想是以位与的方式)</p>

<p>注意：在RakPeer.cpp中定义了一个硬编码的MAX_OFFLINE_DATA_LENGTH长度，它限制了用户数据长度。如果你的数据超过这个定义，修改该值并且重编译。</p>

<blockquote>
<p>优点：</p>

<ul>
<li>你可以在程序启动的时候自动的加入游戏，不需要GUI或者其他用户交互</li>
<li>在局域网内发现游戏的最佳方式</li>
</ul>

<p>缺点：</p>

<ul>
<li>在一般的Internet网络上没用</li>
<li>不如轻量级数据库插件灵活。</li>
</ul>
</blockquote>

<h3 id="方法3-使用-云服务器-云客户端-插件">方法3：使用 云服务器/云客户端 插件</h3>

<p>云服务器/云客户端不需要修改可直接作为服务器目录。</p>

<h3 id="方法4-使用大厅服务器或者房间插件">方法4：使用大厅服务器或者房间插件</h3>

<p>大厅服务器为玩家交互和启动游戏提供了一个数据库驱动服务。它提供了一些功能，例如朋友，配对，邮件，排名，即时通信，快速匹配，房间和房间调整。</p>

<p>LobbyServerTest和LobbyClientTest例子展示了如何使用该功能。</p>

<blockquote>
<p>优点：</p>

<ul>
<li>对于加油游戏的玩家来说比较灵活</li>
<li>允许用户在启动游戏之前进行互动</li>
<li>建立联系</li>
<li>支持多个标题(称号)</li>
</ul>

<p>缺点：</p>

<ul>
<li>需要一个单独并且专用的服务器来承载该插件，并且服务器需要数据库支持</li>
<li>相比一个简单的游戏列表来说，该功能需要一个相对较大的并且复杂，需要在时间和编程上投入更多。</li>
</ul>
</blockquote>

<h3 id="方法5-directoryserver-php">方法5：DirectoryServer.php</h3>

<p>DirectoryServer.php 和相关的代码可以在Samples\PHPDirectoryServer2中找到。通过你的Web服务器去存储一个游戏的上传，同时该游戏是基于字串的信息，这种给出游戏列表的方法比较廉价。要获得更多的信息，请查看该功能的用户手册。</p>

<blockquote>
<p>优点：</p>

<ul>
<li>不需要一台专用的服务器，只需要一个网页</li>
<li>缺点：</li>
</ul>

<p>不够灵活</p>

<ul>
<li>有时候不可用(可能需要多次查询请求)</li>
</ul>
</blockquote>

<h2 id="尝试启动链接">尝试启动链接</h2>

<p>一旦你知道了你要连接到的远程系统的IP地址，使用RakPeerInterface::Connect()尝试启动异步的连接，连接参数如下：</p>

<pre class="lang:c++ decode:true">ConnectionAttemptResult Connect( const char* host, unsigned short remotePort,
const char *passwordData, int passwordDataLength, PublicKey *publicKey=0,
unsigned connectionSocketIndex=0, unsigned sendConnectionAttemptCount=6,
unsigned timeBetweenSendConnectionAttemptsMS=1000, RakNet::TimeMS timeoutTime=0 ) ;</pre>

<ul>
<li>host 是一个IP地址或者域名</li>
<li>remotePort 是一个远程系统监听的端口，你传递给Startup()函数的端口</li>
<li>passwordData 是随着连接请求发送可选的二进制数据。如果该数据与传递给RakPeerInterface::SetPassword()函数的参数内容不匹配，远程系统会回应ID_INVALID_PASSWORD</li>
<li>passwordDataLength是passwordData的长度，单位是Byte</li>
<li>publicKey是远程系统上一个传递给InitializeSecurity()函数的公共键值。如果你不想使用，传0值</li>
<li>connectionSocketIndex是一个传递给RakPeer::Startup()中确定要发送的socket描述符数组中的索引.</li>
<li>sendConnectionAttempyCount是在放弃连接之前尝试发送的数据包次数。这是用于三种不同MTU大小的检测。默认值为12以为着每个MTU发送4次，这应该适合于任何形式的丢包了。值越低意味着收到ID_CONNECTION_ATTEMPT_FAILED越快。</li>
<li>timeBetweenSendConnectionAttemptsMS是指发送下一个连接尝试的间隔毫秒数。4倍的ping值是比较好的。</li>
<li>timeOutTime是这次特别的连接中一条消息丢失远程系统之前等待的毫秒数，(译者注：其实就是无响应超时时间)。默认值为0意味着使用从SetTimeOutTime()中得到的全局值。</li>
<li>Connect()如果尝试连接成功则会返回CONNECTION_ATTEMPT_STARTED，其他返回值都是失败的。</li>
</ul>

<p>注意：Connect()函数返回true并不意味着你已经连接上了。如果连接成功你会收到ID_CONNECTION_REQUEST_ACCEPTED 消息，否则你会收到其他的错误消息。</p>

<h2 id="连接消息作为packet-data结构的第一个字节返回">连接消息作为Packet::data结构的第一个字节返回</h2>

<p>连接关闭: ID_DISCONNECTION_NOTIFICATION, ID_CONNECTION_LOST</p>

<p>新的连接: ID_NEW_INCOMING_CONNECTION, ID_CONNECTION_REQUEST_ACCEPTED</p>

<p>尝试连接失败: ID_CONNECTION_ATTEMPT_FAILED, ID_REMOTE_SYSTEM_REQUIRES_PUBLIC_KEY, ID_OUR_SYSTEM_REQUIRES_SECURITY, ID_PUBLIC_KEY_MISMATCH, ID_ALREADY_CONNECTED, ID_NO_FREE_INCOMING_CONNECTIONS, ID_CONNECTION_BANNED, ID_INVALID_PASSWORD, ID_INCOMPATIBLE_PROTOCOL_VERSION, ID_IP_RECENTLY_CONNECTED</p>

<h2 id="id-connection-attempt-failed故障排除">ID_CONNECTION_ATTEMPT_FAILED故障排除</h2>

<p>ID_CONNECTION_ATTEMPT_FAILED是通用的消息，他以为这没有建立与远程系统的沟通。可能的原因如下：</p>

<ul>
<li>IP地址错误</li>
<li>对方的系统可能没有运行RakNet或者没有调用RakPeerInterface::Startup()</li>
<li>远程系统已经开始了RakNet，但是没用调用RakPeerInterface()::SetMaximumIncomingConnections()</li>
<li>远程系统的防火墙阻止了你所选择端口上的UDP包</li>
<li>远程系统上的路由器阻止了你所选择端口上的UDP包，查看NAT Punchthrough插件解决该问题</li>
<li>在Windows Vista，网络驱动安全服务有时候会断掉UDP，并不是针对Raknet的，而是针对所有UDP连接，甚至是DirectPlay。该服务应该被回滚或者不要安装。</li>
<li>开启了安全连接，并且你的系统安全检查失败</li>
<li>你的IP地址在RakPeerInterface::AddToBanList()函数中被禁用了。注意一些插件，例如有自动禁用IP地址功能的Connection filter插件。</li>
</ul>

<blockquote>
<p>假设你已经连接上了，请转向下一部分:Createing Packets</p>
</blockquote>

    </div>
    <footer class="post-footer">
     
 
<div class="post-tags">     
     
    <a href="https://cppfans.org/tags/connect" rel="tag" title="Connect">#Connect#</a>
    
    <a href="https://cppfans.org/tags/raknet" rel="tag" title="RakNet">#RakNet#</a>
    
    <a href="https://cppfans.org/tags/%e7%bf%bb%e8%af%91%e6%96%87%e6%a1%a3" rel="tag" title="翻译文档">#翻译文档#</a>
    
</div>



     <div class="post-nav">
    <div class="post-nav-next post-nav-item">
    
        <a href="https://cppfans.org/1314.html" rel="next" title="[网络开发]RakNet文档翻译(3)——Creating Packets">
        <i class="fa fa-chevron-left"></i> [网络开发]RakNet文档翻译(3)——Creating Packets
        </a>
    
    </div>

    <div class="post-nav-prev post-nav-item">
    
        <a href="https://cppfans.org/1294.html" rel="prev" title="[源码分享]Aion模拟器">
        [源码分享]Aion模拟器 <i class="fa fa-chevron-right"></i>
        </a>
    
    </div>
</div>
      
     
     
     




    </footer>
  </article>
</section>

          </div>
        </div>
        <div class="sidebar-toggle">
  <div class="sidebar-toggle-line-wrap">
    <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
    <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
  </div>
</div>
<aside id="sidebar" class="sidebar">
  <div class="sidebar-inner">

    <section class="site-overview sidebar-panel  sidebar-panel-active ">
      <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
        src="https://cppfans.org/img/author.jpg"
        alt="NickYang" />
    <p class="site-author-name" itemprop="name">NickYang</p>
    <p class="site-description motion-element" itemprop="description"> 
        Programmer &amp; Architect</p>
</div>
      <nav class="site-state motion-element">
    <div class="site-state-item site-state-posts">
      <a href="https://cppfans.org/post/">
        <span class="site-state-item-count">178</span>
        <span class="site-state-item-name">日志</span>
      </a>
    </div>
    <div class="site-state-item site-state-categories">    
        <a href="https://cppfans.org/categories/">      
         
        <span class="site-state-item-count">9</span>
        
        <span class="site-state-item-name">分类</span>
        
        </a>
    </div>

    <div class="site-state-item site-state-tags">
        <a href="https://cppfans.org/tags/">
         
        <span class="site-state-item-count">418</span>
        
        <span class="site-state-item-name">标签</span>
        </a>
    </div>
</nav>
      
      
<div class="links-of-author motion-element">
    
        <span class="links-of-author-item">
        <a href="https://github.com/NickYang1988/" target="_blank" title="GitHub">
            <i class="fa fa-fw fa-github"></i>
            GitHub
        </a>
        </span>
    
</div>


      

      <div class="links-of-blogroll motion-element inline">
<script type="text/javascript" src="//rf.revolvermaps.com/0/0/8.js?i=5b4f2ucxar6&amp;m=0&amp;s=220&amp;c=ff0000&amp;cr1=ffffff&amp;f=arial&amp;l=33&amp;bv=35" async="async"></script>
</div>

    </section>
    
  </div>
</aside>

      </div>
    </main>
   
    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  <span itemprop="copyrightYear">  &copy; 
  2009 - 2019</span>
  <span class="with-love"><i class="fa fa-heart"></i></span>
  <span class="author" itemprop="copyrightHolder">C&#43;&#43;爱好者博客</span>
</div>
<div class="powered-by">
  Powered by - <a class="theme-link" href="http://gohugo.io" target="_blank" title="hugo" >Hugo v0.59.0</a>
</div>
<div class="theme-info">
  Theme by - <a class="theme-link" href="https://github.com/xtfly/hugo-theme-next" target="_blank"> NexT
  </a>
</div>


      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
      <span id="scrollpercent"><span>0</span>%</span>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
<script type="text/javascript" src="https://cppfans.org/js/vendor/jquery/index.js?v=2.1.3"></script>
<script type="text/javascript" src="https://cppfans.org/js/vendor/fastclick/lib/fastclick.min.js?v=1.0.6"></script> 
<script type="text/javascript" src="https://cppfans.org/js/vendor/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
<script type="text/javascript" src="https://cppfans.org/js/vendor/velocity/velocity.min.js?v=1.2.1"></script>
<script type="text/javascript" src="https://cppfans.org/js/vendor/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="https://cppfans.org/js/vendor/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>

<script src="https://cppfans.org/js/vendor/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>

<script type="text/javascript" src="https://cppfans.org/js/utils.js"></script>
<script type="text/javascript" src="https://cppfans.org/js/motion.js"></script>
<script type="text/javascript" src="https://cppfans.org/js/affix.js"></script>
<script type="text/javascript" src="https://cppfans.org/js/schemes/pisces.js"></script>

<script type="text/javascript" src="https://cppfans.org/js/scrollspy.js"></script>
<script type="text/javascript" src="https://cppfans.org/js/post-details.js"></script>
<script type="text/javascript" src="https://cppfans.org/js/toc.js"></script>

<script type="text/javascript" src="https://cppfans.org/js/bootstrap.js"></script>

<script type="text/javascript" src="https://cppfans.org/js/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
      inlineMath: [ ['$','$'] ],
      displayMath: [ ['$$','$$'] ],
      processEscapes: true
    },
    "HTML-CSS": { fonts: ["TeX"] }
  });
</script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML' async></script>
</body>
</html>